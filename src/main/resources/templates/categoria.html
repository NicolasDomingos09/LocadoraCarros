<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head th:replace="~{head :: head('Categorias')}"></head>
<header th:replace="~{header_admin :: header(activePage='categorias')}"></header>
<body>
<div class="container flex-box justify-content-center mt-5" align="center">
    <form th:action="@{/categoria}" method="post" th:object="${categoria}" class="w-50" enctype="multipart/form-data">
        <!--mvc hidden method filter-->
        <input type="hidden" name="_method" value="put">

        <!--Listar-->
        <button type="submit" th:formaction="@{/categoria/listar}" formmethod="get"
                class="btn botao-azul mb-3 w-100">Listar Categorias
        </button>

        <input type="hidden" th:field="*{id}" class="form-control" placeholder="Descrição da categoria">

        <div class="input-group mb-3">
            <span class="input-group-text">Descrição</span>
            <input th:field="*{descricao}" class="form-control" placeholder="Descrição da categoria">
        </div>

        <div class="input-group mb-3">
            <span class="input-group-text">Diária</span>
            <input th:field="*{valorDiaria}" class="form-control" placeholder="Valor da diária da categoria">
        </div>

        <div class="input-group mb-3">
            <input type="file" name="imagem" class="form-control" placeholder="Imagem da categoria">
        </div>

        <!--Exibe a imagem da categoria (se existir)-->
        <div th:if="${categoria.imagemPath}" class="mb-3">
            <img th:src="@{${categoria.imagemPath}}" width="200" alt="Imagem da categoria" class="img-thumbnail"/>
        </div>

        <!--Botões-->
        <div class="d-flex gap-2">
            <!-- PUT -->
            <button type="submit" class="btn botao-azul w-100"
                    onclick="this.form._method.value='put'">
                Atualizar
            </button>

            <!-- POST -->
            <button type="submit" class="btn botao-azul w-100"
                    onclick="this.form._method.value='post'">
                Salvar
            </button>
        </div>

        <div th:if="mensagem != null">
            <h5 th:text="${mensagem}"></h5>
        </div>
    </form>

    <!--Listagem-->
    <div class="container d-flex align-items-center justify-content-center" th:if="${categorias.size() > 0}">
        <div class="card mx-3 my-3" style="width: 100%;">
            <div class="card-body">
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Descrição</th>
                        <th>Valor da Diária</th>
                        <th>Ações</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="categoria : ${categorias}">
                        <td th:text="${categoria.id}"></td>
                        <td th:text="${categoria.descricao}"></td>
                        <td th:text="${categoria.valorDiaria}"></td>
                        <td>
                            <!--Editar-->
                            <a th:href="@{'/categoria/' + ${categoria.id}}" title="Editar Categoria">
                                <i class="fa-regular fa-pen-to-square" style="color: black"></i>
                            </a>

                            &nbsp;

                            <!-- Botão Delete que abre o modal -->
                            <a href="#"
                               title="Excluir Categoria"
                               data-bs-toggle="modal"
                               data-bs-target="#confirmDeleteModal"
                               th:data-id="${categoria.id}">
                                <i class="fa-regular fa-trash-can" style="color: black"></i>
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Tem certeza de que deseja excluir esta categoria? Esta ação não pode ser desfeita.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn botao-azul" data-bs-dismiss="modal">Cancelar</button>
                <!-- Formulário de exclusão dentro do modal -->
                <form id="deleteForm" method="post" th:action="@{/categoria/}" style="display: inline;">
                    <input type="hidden" name="_method" value="delete">
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    const confirmDeleteModal = document.getElementById('confirmDeleteModal');
    confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const id = button.getAttribute('data-id');
        const deleteForm = document.getElementById('deleteForm');
        const baseAction = deleteForm.getAttribute('action');
        deleteForm.action = baseAction + id;
    });
</script>

</body>
</html>